import torch
import os
from transformers import AutoTokenizer
from qwen_ts_for_inference import Qwen2ForCausalLM
from chronos import ChronosConfig


def inference_with_multimodal_model(
    model, text_tokenizer, chronos_tokenizer, 
    text_input, time_series_data, 
    max_new_tokens=100, 
    do_sample = False,
    #temperature=1.2, 
    #top_p=0.9
):
    model.eval()
    device = "cuda" if torch.cuda.is_available() else "cpu"
    model.to(device)

    # Tokenize text input
    text_encoding = text_tokenizer(text_input, return_tensors="pt")
    input_ids = text_encoding.input_ids.to(device)
    attention_mask = text_encoding.attention_mask.to(device)

    # Tokenize time series
    time_series_tensor = torch.tensor(time_series_data, dtype=torch.float32).unsqueeze(0)
    ts_input_ids, ts_attention_mask, *_ = chronos_tokenizer.context_input_transform(time_series_tensor)
    ts_input_ids = ts_input_ids.to(device)
    ts_attention_mask = ts_attention_mask.to(device)

    # Call generate
    with torch.no_grad():
        generated_ids = model.generate(
            #model=model,
            input_ids=input_ids,
            attention_mask=attention_mask,
            timeseries_input_ids=ts_input_ids,
            timeseries_attention_mask=ts_attention_mask,
            max_new_tokens=max_new_tokens,
            do_sample=do_sample,
            #temperature=temperature,
            #top_p=top_p,
            use_cache=True,
        )

    return text_tokenizer.decode(generated_ids[0], skip_special_tokens=True)


# Example usage
def sample_inference():
    # Specify the actual path to your local model
    model_path = "Qwen2-0.5B-SFT"
    
    print(f"Loading model from: {model_path}")
    # Verify the path exists
    if not os.path.exists(model_path):
        raise ValueError(f"Model path does not exist: {model_path}")
    
    # Load the model with local_files_only=True
    model = Qwen2ForCausalLM.from_pretrained(
        model_path,
        local_files_only=True,  
        trust_remote_code=False
    )

    print(model.generate.__module__)

    # Move model to GPU if available
    device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
    print(f"Using device: {device}")
    model.to(device)
    
    # Load tokenizer 
    text_tokenizer = AutoTokenizer.from_pretrained(
        model_path,
        local_files_only=True,
        trust_remote_code=True,
        use_fast=True
    )
    
    # Create Chronos tokenizer with the same config used during training
    chronos_config = ChronosConfig(
        tokenizer_class="MeanScaleUniformBins",
        tokenizer_kwargs={"low_limit": -15.0, "high_limit": 15.0},
        n_tokens=4096,
        n_special_tokens=2,
        pad_token_id=0,
        eos_token_id=1,
        use_eos_token=True,
        model_type="seq2seq",
        context_length=512,
        prediction_length=64,
        num_samples=20,  # From YAML
        temperature=1,  # From second snippet (not in YAML)
        top_k=50,  # From second snippet (not in YAML)
        top_p=1.0,  # From second snippet (not in YAML)
    )
    chronos_tokenizer = chronos_config.create_tokenizer()
    
    # Example inputs
    question = "Did the patient experience any rapid glucose fluctuations (>2 mg/dL/min)?"
    time_series_data = [146.07033692648258, 145.3859549962693, 142.90343435088616, 146.84498632505333, 146.61949890005252, 142.2024886326101, 140.57884474297242, 144.51367292302325, 146.66317388125185, 147.14074764775552, 145.73436887627872, 146.2140803224276, 140.23900782960007, 144.3248630005824, 143.91840590186035, 145.74951602863436, 144.15824180914782, 143.68160364656237, 140.64181042636898, 143.95607113680202, 146.04283650399074, 142.82184521777478, 145.59358814014996, 143.85670504581816, 142.09739939921582, 149.5207772398418, 144.33177108733045, 146.06043118800807, 146.55248827972525, 144.44652879105018, 139.69436960952908, 143.87705940425386, 147.3436848651397, 146.49173663277296, 140.2372585155, 146.10828266876382, 144.0932534745765, 145.3022593640959, 146.47544587386096, 151.24234074663522, 144.1632985507863, 146.09648174669277, 147.50505796050786, 145.01967974833056, 147.87099162709828, 148.13741590362648, 143.00305805740982, 146.24585083549275, 146.2578530758128, 144.59151267112034, 147.90442533317696, 143.646848527986, 147.9498529523065, 146.555834017949, 148.0370065813464, 147.66344275809124, 143.66326813687036, 145.0935833516581, 148.53362107444545, 143.5323231303124, 141.7330831711641, 144.33274027390436, 146.2993857608065, 143.7311204020152, 139.10544094196226, 146.49536913543326, 145.4816731342994, 145.39800248797317, 142.2523766354142, 146.06767509374922, 146.6672248694564, 148.3299253408666, 147.1149473337594, 144.64413381642922, 146.61092459589253, 144.63690450935744, 145.32314897651975, 147.69746604449531, 147.93194831100732, 146.4911957803711, 143.33471148954095, 144.33441912707687, 146.34794780722353, 148.82519096600515, 144.15752990134146, 145.25136967681607, 147.23698001299846, 145.78477554198577, 143.402692074125, 145.00984567147657, 144.57175667235978, 143.5439845670581, 148.0060867333066, 146.84172866218114, 147.24958975124446, 146.20480182427158, 145.77779803881947, 148.3909412062806, 143.05746582149038, 142.05501039957207, 148.90843336639597, 147.5628272604299, 143.24589531857524, 143.4636643325321, 146.02899570202075, 143.92612400837663, 145.75280179048355, 141.5692651268141, 144.4612542952507, 143.98993064459353, 149.0082946462003, 146.32101439053784, 143.24209766320956, 147.26658987826028, 146.83619959322408, 140.54569283058927, 145.76567136738646, 141.9848312932886, 147.27221111848266, 144.39366602584255, 141.49352840690545, 143.47894811377864, 145.84738869689602, 145.07810854487667, 145.33183741156031, 144.19530307101593, 145.5000898822038, 143.5419498559141, 146.71933579533226, 146.7144615465653, 143.96415607743526, 143.23567711083925, 145.51043722084952, 146.69320906019962, 147.45734101370903, 143.9326841197579, 146.67011562745677, 146.50449149488298, 144.23662907280007, 146.3165464580709, 148.46823871930155, 144.75737370340158, 144.32188231956815, 144.9901426422214, 144.18193570150282, 144.9429126124802, 143.61940602787212, 143.29205212203402, 146.32743890730254, 145.20837553886508, 145.72474275849964, 144.01376091313702, 144.02116710225573, 144.11119991381773, 144.66959951535574, 144.89855762404795, 146.66530137978734, 147.48845728463357, 144.13602724241022, 146.5631529247187, 140.45492784511262, 141.9667639774839, 142.58394540227766, 143.74883223519439, 144.52451775826216, 143.93720780441092, 143.09826782088894, 145.7870566030738, 146.5341111586161, 142.75998063341123, 145.5709862742259, 146.56664717314314, 147.26494780205064, 146.2146978456017, 144.6634230764739, 144.6141994709586, 147.03911521118349, 147.75611287521244, 147.3323797638334, 144.20178241336748, 144.76504395721102, 142.55782633347062, 146.4776554177302, 144.33823045986273, 146.98989629968054, 144.57613496566535, 142.63393074390848, 143.23023072112645, 144.7224567040643, 143.89101801515253, 147.77971018201, 147.25836466063197, 144.9839579932514, 143.20656316765854, 143.15951776461802, 143.69597219440885, 142.3774730553393, 146.20940353138187, 141.62673669039685, 143.66928075290784, 145.9110811516715, 148.5870756163201, 146.89944768176548, 150.5337064742089, 141.84076565282166, 144.28706710974214, 145.9373466365527, 148.36372577544026, 143.46164841092062, 145.52150639627433, 144.92419000867812, 149.7769121364246, 146.07381145846276, 144.85736331971913, 147.83889183059674, 144.83424557260136, 145.17732339160744, 148.3590358629804, 143.81513837789666, 147.0834504402397, 145.16563364725235, 143.7960498924008, 146.68141540713648, 144.36839825906594, 148.57040604364803, 145.98983749410456, 146.23390945818696, 145.33739014572603, 144.20398381936647, 145.56039653346232, 147.80580216944895, 144.27322121146184, 146.00597598593288, 146.69633380768204, 143.22345888225072, 145.00287789211112, 146.20663144114707, 142.99907978142477, 144.2834665972448, 146.5136921322561, 145.65754045959775, 146.5757494831406, 145.5670716095715, 148.33171316436201, 142.7228292720218, 143.49164187756557, 147.8165346842358, 139.990781654184, 141.8689531109128, 147.6541816347012, 143.24203916578426, 145.34754164050182, 142.81687212072637, 143.77802350737926, 146.7121949825623, 146.30167033562876, 149.28470508208213, 148.76360447470134, 145.96554184839866, 144.41052582271735, 146.1296306626989, 143.3832003530645, 146.162267823252, 146.27198454680664, 146.95442946456018, 145.25762808768283, 144.78683198512786, 142.7017699667146, 146.82574606255227, 144.34823098293205, 148.37176807360763, 146.0108482409755, 145.02249600373614, 144.09475219302237, 146.44772594865552, 148.70672727065696, 143.98514835978725, 146.1228742090523, 147.41675338487894, 143.5201625266322, 148.45004264664047, 142.70473855981106, 144.98309521139694, 146.16536307536046, 143.77557821428462, 146.79629171733424, 144.03597998742543, 145.87186413272897, 142.69948493375645, 147.90283971834353, 147.78849946671448, 143.46023045135664, 142.39576130220135, 142.6670315970416, 147.48189318930156, 142.76167943688503, 145.08612078371715, 145.60709707420378, 144.710982207276, 147.158978801156, 142.8928620602478, 149.0863858045884, 145.4900306351336, 143.93443709480613, 149.72664393848976, 147.3826387273617, 142.5351592905821, 144.4636103460972, 147.60915502431172, 144.8982698950771, 142.40285895972613, 141.5488927194065, 143.76524272148464, 146.18046106674765, 140.39033623398512, 149.39501482879152, 144.89296176328978, 145.5523697286729, 144.8823386092705, 143.16526851273352, 140.1031825972244, 146.87070462201976, 145.3621431492791, 145.09646024391594, 144.63694297503145, 146.51744673678337, 145.669052588949, 145.7051228210075, 144.6955623573736, 146.22908102418646, 143.95360070141538, 144.82739866387908, 140.54070246119778, 144.86117157441228, 147.69264361177176, 145.9055551361922, 146.32115161924816, 143.39801570806375, 144.80370919431462, 142.89656723182588, 148.87878925409964, 145.29209676330325, 143.63652722832484, 144.0060677713284, 142.7345370326981, 146.14238068373288, 145.9014779493057, 145.65872733667294, 142.3888726315637, 144.87197588807476, 147.49862120428057, 146.4604880688732, 144.89598452375353, 144.80207910211664, 144.61543057806375, 144.45827864003482, 145.2058005006066, 144.46603395521518, 147.31468361136487, 142.19571058448497, 143.14076141917982, 142.05354133835306, 147.02154857728075, 145.3066757115704, 146.2428573113936, 146.93765738848145, 147.14647437881473, 146.13046616433314, 147.14326178119154, 145.4942620540954, 142.12253114869083, 145.85243782529096, 143.1295005041384, 146.15864648691453, 145.08971360706138, 143.29457375470784, 143.06587994310138, 148.0106805153336, 144.88087952518575, 148.75346314448845, 147.47147032115112, 145.9236048723864, 144.08196609328516, 145.27505865609282, 144.5003883721374, 143.00646715392375, 147.21704936933483, 146.2643058224498, 146.18654887867726, 146.38030220482682, 149.81873410825693, 143.79583012118619, 144.16547877959127, 143.06346919981172, 146.43066649827108, 144.93591530052768, 141.8006303013127, 141.81868953728585, 145.9943657102791, 145.1976742597195, 143.50750500772054, 145.12546902769782, 147.80133540507774, 144.9496650795895, 146.4681439341367, 141.26622984218122, 144.59415972486914, 141.21215071237796, 144.13311821300377, 145.7894435841886, 143.20031849166068, 143.05053526428782, 145.8759271113322, 142.91738777190244, 145.10537171975656, 145.24418524634382, 142.3386264326951, 144.9080845918607, 147.94603499969404, 145.71052082796012, 145.05994891700976, 142.76318823372287, 144.40687724964218, 146.06705015257083, 145.75816434494809, 143.98416106169606, 146.72127322358122, 145.2643284874348, 143.98283475321085, 144.51829510911415, 142.2241203470956, 146.02669636928042, 144.1235557021812, 144.9561714582705, 145.4529028808943, 145.31894550367127, 146.34376448109026, 143.53906648906965, 147.59917881478603, 146.2149251976339, 144.21715552208298, 141.66034369005874, 145.12858621251067, 145.94071160420827, 145.02375323882444, 145.71434646405373, 147.80885475565285, 144.65101233084565, 144.41895206452944, 147.09016084219428, 145.54794064283945, 145.80193597763056, 142.2666648476148, 146.11341545811683, 143.606524285792, 147.483370291828, 142.59850864078237, 144.90718327022037, 145.33505270731607, 146.60015796100413, 151.4113800777752, 145.95324485321876, 145.1346153200585, 151.05335297378315, 152.18707601117129, 147.17921703376004, 152.0931461338733, 152.1781655125519, 154.37551547853397, 154.67174842344184, 156.05425677594832, 155.19455859504075, 158.73660894430236, 155.62165659311492, 158.9445931983374, 158.35337058416462, 159.43613011773687, 161.138767652991, 164.52526661340897, 164.11130009166448, 164.87419347904387, 165.16746503473877, 172.608117938559, 166.63553045850952, 168.95836777771004, 170.31003539473045, 174.40837265901214, 174.32501857857298, 177.53333708476077, 175.01194904795832, 175.93737436649522, 179.45118160484338, 175.4876067474973, 181.0108529515104, 179.21695504282297, 178.96778599108413, 182.89896708232487, 182.55964648575096, 179.3266867750145, 184.7692741737869, 188.15398046280757, 183.76430975560518, 185.7148189287366, 188.44775996287234, 187.50753862183853, 183.4277070649036, 184.34332524630707, 186.8877254423045, 189.0743638754443, 187.52990263202358, 189.4933467857159, 187.78539789098474, 185.3930141710491, 187.323315149114, 185.84213993602822, 188.6199304090147, 186.1624784403964, 187.46229664258053, 190.7992024101444, 184.69868544344303, 187.4116928306652, 187.64354817697085, 185.27667059117886, 187.2789364066664, 187.79375816919253, 183.7234530592279, 187.49670637570762, 189.56393182071398, 189.60226475979235, 186.3597679619001, 184.3088853631523, 185.3023449796752, 181.88977288763414, 183.98668451264288, 184.7140039750827, 185.5840881824764, 182.9663716941058, 183.99653562883066, 180.98173309008135, 181.53850130144022, 179.17786848329172, 183.17268306326457, 179.11118383899398, 182.30041310369515, 183.1708981668808, 180.2289908339928, 179.88738677047667, 176.67099231844256, 178.39931032929385, 178.0303640896163, 179.36545847547114, 175.60442038376564, 175.44075224245867, 176.55682684880622, 176.08949868438157, 179.03646025977648, 172.97990401261907, 174.32493831755596, 176.94245105881728, 176.3306654540474, 174.31867881668862, 172.84881079695703, 174.16109981608923, 173.10154334864782, 170.97224491687138, 168.2239066108601, 171.0434333058574, 170.5563398553811, 172.10846800878338, 170.56188909979076, 173.83747955038845, 172.88305671498543, 166.85853439938438, 166.774457541334, 164.80115119145188, 168.4393086438131, 166.86520078141214, 167.76127476872855, 166.1987592348179, 167.88940131437562, 165.80522463127, 166.44038898987287, 162.48578559415816, 164.67517754345198, 163.10970195781059, 165.6923801509137, 162.760262448829, 157.9988403278198, 162.6453928459731, 163.7850377093395, 165.23678836482733, 159.26479026518044, 161.94222828948133, 160.2629296540127, 161.2336859649576, 159.92457770633737, 161.23157311116103, 161.02991249445694, 162.52514087779593, 158.41705981237337, 156.44197929508144, 155.90095794639893, 161.77239989563114, 158.36544889109004, 159.2978989971535, 157.80055168438224, 159.24266534914932, 160.87497923920517, 156.32430929871606, 161.08429160518065, 158.0887190866777, 155.6123312821966, 159.35907815308852, 157.39894001403715, 154.71736959775694, 157.5088068674072, 151.0223126739981, 156.44192328822794, 156.4122743340327, 154.2265083767784, 152.99255192130929, 154.73095183349378, 154.48643026266376, 156.95585741613218, 154.9217633953749, 155.62458251075833, 152.9888658194746, 154.54076263205195, 156.0604925632036, 155.45313087797047, 157.22686516669143, 154.3313313989893, 154.9598931351612, 152.46720025220017, 153.00732337260467, 152.9586225525079, 154.8327017532646, 150.70127072806886, 152.0475686198981, 154.89530810092845, 153.5350587565564, 148.8423010015117, 155.40079769808673, 152.6145412200823, 154.6882928441115, 152.93050552292783, 153.15242556292915, 154.9169230646732, 154.19802837089065, 153.47030635518843, 154.8148055539795, 158.48952929767782, 158.8800291192599, 152.55951199726584, 154.42779763469755, 154.12887091873912, 153.19190909433462, 159.63814023540914, 153.5990601723473, 156.76410031695687, 158.2294454766127, 158.8777455590577, 157.7843256327308, 162.62206804281743, 160.8081848355456, 162.2521317011603, 165.47156852931755, 164.7336808702254, 164.56823231452418, 166.70887263216906, 167.0132724135687, 168.1845896393686, 165.89384357123276, 169.2595458682564, 168.42484050236476, 175.13353425285973, 175.42258730876893, 174.21015211068809, 173.81807641056258, 174.02021443744303, 176.5132359253293, 176.34360677105553, 176.79695050551027, 175.8497829489822, 178.85203209580405, 175.90659264047179, 175.5566333069183, 180.30069310715706, 176.8764911421283, 176.85956303154083, 177.32785147732687, 180.94961813200882, 179.68562838810666, 179.64054206358654, 179.91022984439542, 177.32715627248243, 181.0225318294686, 180.27100549338567, 179.6254410092521, 178.16840498675128, 178.28170720557708, 180.9544241241026, 177.62544057721587, 175.46914733811062, 178.26973573206394, 178.7467698806178, 179.30363087528278, 174.91748305018308, 173.32286770422462, 179.47861056815736, 176.12949417667545, 178.0661088264218, 175.17820771673107, 173.3120472492417, 171.5985208456067, 171.20026030352983, 173.19509354609463, 170.75285207272114, 173.86545306482094, 172.86884361624914, 173.76231744274696, 171.12761912374143, 170.6198768115172, 169.94372232168828, 173.06941218629646, 164.31624818230674, 165.926083682778, 167.45180842862166, 165.06212723640314, 168.5164988976101, 165.35254376940384, 161.43745119283102, 163.69572596118707, 163.94688277394448, 163.27104388746406, 162.99712656923418, 160.74398819559673, 161.0086769627727, 159.17306736871905, 162.79769137614264, 163.70530363635058, 156.97021785068242, 160.51145253706727, 162.12619046932903, 157.66701509341146, 161.28164212610528, 154.30681052682576, 152.79728763308427, 154.69529972932315, 155.80276818571048, 157.57001151530088, 151.13624696888434, 154.9979264967783, 153.1608184378076, 150.87783670219576, 150.9757725891179, 149.1096461075203, 148.11254458835896, 151.03077126280562, 150.7468731895913, 148.5265342423902, 148.06290704419354, 148.46168496310128, 147.60249571322188, 142.919254319313, 146.54874562336454, 146.64567073084618, 144.6524635003024, 147.08237156804, 146.7126786057534, 144.54693658394612, 141.7576448900748, 137.46243522065575, 141.32849268844865, 141.8854644673554, 143.34999171102683, 141.6383097535367, 139.26819142804047, 141.44033549703178, 140.06652970544843, 137.8141294239776, 136.14747163185248, 138.76843655308238, 139.19302230505215, 139.46068319197352, 135.3273886161385, 135.27691178882088, 140.1070686257102, 135.36367541327567, 136.24832292635475, 131.020916714027, 132.26518433283294, 134.91788403273773, 134.017431901291, 135.6711343244808, 134.0842055170622, 138.76633139698643, 137.0216168830309, 136.01361914939048, 136.15259776694876, 135.64756585522343, 141.6922810723486, 137.5360286369134, 139.33130238354642, 139.25913410239423, 140.53353580505348, 145.38830969873703, 140.73815152240093, 143.49893997136385, 143.592959947401, 151.4313105538693, 150.72265591923446, 150.00930899807508, 149.9819669266321, 154.6473711993299, 152.88951429022015, 152.7099861751648, 157.60183032864927, 160.6363633953794, 160.07317397955114, 163.2198383803886, 163.3337715050749, 167.5138539429962, 167.98737036368584, 168.98071325244365, 169.83063127516223, 171.35896717136188, 175.64744329921166, 173.0735847519218, 173.40406294367963, 176.16693848104183, 178.15465547482117, 181.45241577504578, 181.93176595473392, 182.50926155184933, 181.88619657544425, 190.21703465950173, 188.34719741003394, 186.1018644604841, 190.52985905951783, 188.80067782318017, 190.495265582566, 190.2528433000521, 188.26557349649977, 191.1810758057659, 191.8132120674084, 190.1641667726823, 189.81068175774058, 192.151742387142, 191.7668428689449, 190.66886144307733, 193.7752556433117, 191.089025338715, 192.50015503727963, 191.28919278872283, 191.24333176216544, 187.9816315915887, 189.4056485758756, 192.6161825024932, 188.29858850234916, 187.59387499076735, 188.36442269641216, 187.25409797956635, 189.28434634251823, 187.8184210990087, 184.2075872835731, 185.0397885146106, 185.78546668305762, 184.26965355507892, 182.61614123601072, 181.1001895959058, 183.12114174906117, 179.0516987123479, 180.3454870076036, 182.87143347467213, 177.3346296393453, 176.46675717864042, 181.17459017710846, 177.89671867563897, 175.6272151608484, 176.27481382325547, 171.38873938694186, 171.67366936275664, 171.83480862850067, 168.7912297686891, 167.92056393024518, 171.26598195653335, 168.61152233929167, 166.67767229491145, 166.85747898586192, 162.54994009331378, 164.487270795285, 161.82995899877216, 164.03051368235555, 163.2203185425492, 163.75347936465, 159.22023081474558, 157.2468451482622, 156.81823284990563, 155.93956856971454, 155.84730833753187, 154.6383319692333, 153.72030617774348, 152.56950191341946, 152.19738688297164, 150.49550995850896, 152.55932059655763, 149.07151097028253, 151.8621915957508, 145.06350313869174, 149.34563861885945, 147.62921396639678, 145.26296409230935, 145.29957677586987, 148.44507632104936, 148.46486128531436, 149.0643209702952, 148.02153694698202, 150.2582845235012, 150.87061181639996, 154.65120885612527, 153.14247722368182, 157.21046505673195, 159.0323054370282, 160.2924972372818, 163.16844963280354, 163.0993887820574, 167.58394102676633, 168.1581874904545, 167.3166290786991, 171.1807794274217, 174.78238536289933, 173.9882424294537, 177.17697363007164, 172.54525177049422, 178.14000444740282, 179.96545873197275, 185.2474912686681, 177.79826377106406, 180.87227690110367, 184.8937687580086, 183.7344328372939, 184.68277444894795, 180.5742801604685, 187.3348073339008, 183.89412535098975, 185.20939977498102, 187.37374034183455, 184.74636214840277, 185.44568231850553, 183.5340640277495, 189.97123999719315, 189.23516154770635, 191.34875778116657, 186.81807667285085, 185.00061677420032, 182.07240000707992, 186.32980511300718, 185.08737359806312, 185.0620785295287, 180.75529566877753, 183.1474283900058, 184.1843859743755, 185.71961177650482, 177.4767745770919, 182.1054476585625, 179.9091581861981, 179.6510978033042, 179.6456196509032, 176.44800749807706, 177.94983689364568, 175.3172938924708, 175.26228987425546, 176.65853499524917, 170.32072785814444, 174.3053882732216, 175.89792246449505, 173.62677942682143, 168.9227418836871, 170.48658487629746, 170.59799460770893, 171.73803776036226, 165.22093036308402, 165.25113695717235, 166.05936657519945, 167.19938114616488, 162.7473232227918, 165.71139392792188, 167.13404345348826, 158.7272258894721, 162.68786366086033, 158.2236258951743, 157.79438219705585, 162.63769823789275, 156.72068497165395, 156.81850784556866, 158.9816472466961, 154.2087747861747, 156.07592832204324, 153.48468564972677, 152.34825098041975, 147.9742846172045, 150.31778008130067, 150.07844572991272, 148.31548478179553, 151.96807092802288, 150.15437647341466, 148.73122851656626, 150.3235677052013, 147.0636033920403, 145.72059219752785, 145.32169179560995, 146.3339152870292, 142.5983815467944, 145.39142203786065, 145.53009078819173, 140.4840346029781, 144.45331537995156, 141.1690886274183, 141.53543950800312, 139.57009370783604, 136.34424734152606, 138.6452974915505, 140.18258150932138, 137.80579034339772, 139.09183038832677, 135.8260667159203, 137.8416058413842, 135.93429083005603, 137.88297457672968, 133.13061638799047, 134.01567200204954, 131.83380793723956, 134.06308407163078, 132.41180666888184, 130.07456673554643, 133.40075309051903, 130.62108639401714, 132.26776876687998, 129.32448386367068, 129.9605697180328, 129.15230377483056, 131.7693992082944, 128.02938648043923, 129.5591163489176, 130.1870204789494, 127.9426084301677, 127.63624008810258, 125.30490301661098, 123.06415527643533, 127.78037544911518, 126.7123128435098, 123.85699713257938, 123.81642372657596, 124.35049333156556, 127.0656728269162, 122.86420962678311, 127.32634321711532, 122.11794523467539, 123.20313206963189, 125.22773278501326, 122.79358820863126, 121.07834562142136, 122.1784291692744, 124.93700501398024, 124.66116470563198, 123.14229154725658, 122.3764693502752, 125.29685509848962, 119.32385796107772, 120.77498995468935, 119.8415862172204, 122.4665683351777, 117.880939459402, 121.86522539862509, 118.73201866999136, 122.60321611770358, 121.88120717051711, 125.30855024513512, 122.85234990048632, 123.62585122980637, 122.80463219902808, 122.30243040241464, 121.81237597482233, 122.60540949117926, 124.1419726977978, 118.66294243003706, 122.40819048048391, 120.58828320191844, 122.68607210689852, 125.53525713482695, 125.06755438590814, 121.73725869962674, 123.47213499193572, 125.60508477459656, 121.40724967245235, 124.09700314435749, 122.56776443303528, 126.1510371608588, 125.47843591729728, 126.16404093441686, 128.40745218338117, 122.41831309379809, 127.83575313479278, 123.88288604545319, 126.23746383965904, 130.64495304561527, 131.21799686663263, 130.5928247625029, 129.95804812137808, 131.18926961593544, 135.0991503779532, 131.95251633491202, 136.22140373322551, 130.99825781020627, 130.490142405084, 134.533020379326, 135.55204890447368, 136.82072720919626, 138.4583175263603, 133.85986754061344, 138.2725691349595, 136.25910917360812, 143.74435596449143, 140.8325087778284, 140.94624762182093, 142.2372878229946, 143.7170017053912, 142.52386145349575, 142.68219549208558, 139.91547916223126, 141.25342357475964, 142.6678461748784, 141.28702508084166, 143.75032605454382, 143.54970257657692, 143.6448472309994, 144.58131788304414, 149.1656073732036, 142.01809031548885, 146.89346293015157, 148.07321961307738, 147.92524533946477, 141.6389253774126, 149.01868730579204, 141.93085048925906, 143.78197440505912, 145.44352700744918, 148.90386818588584, 150.196543635255, 149.51834225285376, 147.61023628281725, 150.95424232090153, 152.7867994421876, 151.08966541845533, 147.97649491393872, 156.37681252443025, 152.17622096048532, 152.84007972053357, 152.33538490215705, 155.54683479114294, 155.73400644782922, 154.43564664293294, 155.62596268348594, 157.57111645231217, 159.75447628630369, 158.80121596489022, 165.18769095671962, 161.60134894180044, 161.25213148731197, 160.97214955636767, 163.52683667205608, 166.7596593899078, 164.22256713987124, 165.10632399980992, 169.63237874528693, 164.62987704986307, 172.72914474002323, 167.69593551526592, 165.32189771274943, 167.97912168216547, 169.7944712226797, 170.99433525076665, 166.95308545176806, 168.2711358864739, 170.09842965669117, 168.55605122734147, 168.8544867039616, 172.35858091652682, 173.33242960452253, 171.15566072054537, 168.21775465897053, 172.78653088316824, 168.82546711907574, 171.65709594739874, 167.63317514685215, 170.79703758507543, 167.8194620320924, 169.51794807885196, 174.5345884078889, 165.1248742772279, 169.15725021048053, 166.5240570042278, 166.2492435494771, 164.99453228105202, 161.29279547829086, 163.54469495462862, 162.96756217630926, 166.666484146477, 158.30016669819864, 160.69767626445093, 158.997241082707, 161.2703485527208, 160.53618633826719, 160.46916993334966, 154.6890965696142, 155.47842853152858, 156.68060315757594, 152.66749237980403, 153.72802751695397, 152.80135889478956, 156.99425100440692, 152.5375074798776, 152.47205067213596, 154.83085684384267, 149.44701377742462, 152.9064332933234, 147.09260162348292, 151.74036842638102, 146.25885935069843, 145.3282397707753, 143.15112899214122, 144.25438771476945, 145.1864873415418, 145.00847124159918, 140.91026194824983, 140.2474920597445, 139.3926126698971, 138.3920391322485, 138.82083286193782, 137.63546207241336, 134.10719166945816, 133.0728878897024, 136.30213475753268, 136.68673013586067, 135.36559936929663, 134.2885722178998, 133.99486084245916, 132.75285039930074, 129.82291489601715, 130.6663364361555, 127.68378821156602, 131.6101371805263, 124.77491656554314, 127.31495769799474, 129.07864656533218, 128.7539283453764, 121.15108293026732, 123.99218944558051, 122.69554557126052, 121.94150445011346, 120.93146575341616, 123.31887650634022, 122.22445093615138, 121.48301635760828, 121.6534164937415, 117.6536552751524, 120.38624470914944, 114.3400445505711, 117.36941538437206, 116.76207613220473, 115.74630772539585, 114.35554286404344, 115.51394374908143, 114.80132409983987, 114.22702182039956, 109.16173971672886, 112.17358387046096, 118.64570198199688, 112.302389572986, 111.8612179240374, 112.74650924724399, 110.14765039798787, 109.16775750256855, 104.82741744846724, 107.28393288412222, 105.2218588041862, 105.99847018680899, 110.17853266732592, 106.35758432772784, 105.04166887051639, 102.10635137560874, 104.08917591355055, 105.26350339613504, 104.31601347877299, 106.65112185054646, 106.16203781970435, 104.08594666951983, 100.68478801241756, 100.77621529199656, 103.61679890902302, 101.66927430666355, 102.9681906283706, 103.12700511323344, 101.2115393221419, 101.30824660855623, 98.2581241520706, 102.95623027516021, 100.37761524909405, 97.54539894013584, 98.97268219249207, 99.09662092795996, 95.2605597908739, 100.09763283498842, 99.19502964475018, 97.23412894396044, 95.30749727954986, 97.80782979000323, 99.9780099486862, 94.17764525000888, 101.23586093780317, 94.81240503612737, 97.31817118665667, 94.98973627535665, 97.32861225434529, 95.13511971407364, 95.43142833012288, 98.14121853566637, 96.49222305801491, 98.66895781706063, 94.4303201112268, 100.31336181270446, 93.65617567314723, 92.92560475740689, 98.34720972701056, 92.6879566748132, 93.96926745861364, 97.88351367414329, 95.37441536730543, 93.29580135766871, 96.13294628647482, 98.98733249627762, 98.4614837300911, 96.05517792083495, 96.99101025913036, 99.00245160690918, 98.3143769985002, 98.61063902793923, 100.41133007380093, 102.21422717334033, 103.70927943608082, 103.2906662854841, 100.88955456985573, 98.75513957835871, 103.14614446512341, 104.22231824042406, 105.25860354664029, 102.5394098204668, 102.30683874722993, 106.27055717253884, 102.40672319669075, 106.00492652592887, 109.57508141168407, 106.63646305183015, 106.49666354798727, 108.07020939741327, 107.23924423158486, 106.75801221589953, 112.38465774830962, 110.46779098650889, 107.51447525543365, 106.88991846345944, 109.54879984335427, 114.42474916019249, 114.8000595017907, 110.95533356393105, 115.03212343820546, 114.5752989466152, 115.51879298604493, 115.96900323212853, 115.15515140765572, 113.6207609221103, 113.07334413905365, 112.9812784567226, 117.52688944918036, 113.96913266065084, 115.4882950706273, 115.09084941541921, 118.94038038618444, 115.53350984247766, 120.05807122716263, 122.00611177253643, 118.86956212887051, 117.52033606305847, 121.56406022024579, 118.4773763371969, 121.20063112625371, 118.12882226110854, 121.02882137581166, 117.6789284169295, 120.15067872172536, 120.40621988726122, 121.18903521229213, 119.16635637118391, 121.44901771424819, 117.279760086357, 120.44232126559812, 120.54228230275127, 118.04549002008544, 122.30540783254703, 122.775868767055, 124.10181096892111, 122.29784775562204, 127.84804874677165, 123.67565802279196, 118.32069415777546, 120.976938641251, 117.406756350464, 115.23587803565125, 119.29753176448479, 118.40196799406203, 119.45600228917297, 117.04183555745857, 119.18753888138943, 120.08764297654382, 114.8298863444317, 118.12145248756029, 118.39371120574356, 116.60100462176456, 118.07286329635389, 117.63972764916494, 116.9921012262594, 114.9438067840605, 115.89130852140816, 118.68569918287695, 113.48204379667048, 116.85247335916294, 111.65351994214681, 117.18192714089137, 111.19437838917695]

    # Run inference
    try:
        print("Starting inference...")
        response = inference_with_multimodal_model(
            model, 
            text_tokenizer, 
            chronos_tokenizer, 
            text_input = question, 
            time_series_data = time_series_data,
            do_sample=False,
        )

        print(f"\nQuestion: {question}")
        print(f"Response: {response}")
    except Exception as e:
        print(f"Error during inference: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    sample_inference()





